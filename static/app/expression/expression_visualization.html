<div layout="column" flex layout-fill>
    <div layout="row">
        <md-card flex="40">
            <md-card-content>
                <md-text-float>
                    <md-subheader class="md-accent" ng-show="!closeAlert4">
                        <button type="button" class="close" aria-label="Close" ng-click="closeAlert4 = true">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        You can select a scatterplot or a heatmap, then export it to a PDF<br />
                        But before, you have to load a list of genes or to execute a job (see below)
                    </md-subheader>
                </md-text-float>
                <md-text-float class="text-info">
                    <p>Select the plotting options below, these will be applied to the charts generated by "Show chart"</p>
                    <p>First, create a chart by selecting genes in the table below.<br /> Next, click on show chart to display a dynamic chart in the browser.<br />
                        Finally, if you want to save the chart as a PDF (scatterplot, heatmap), click on "export as PDF". <br />
                        The file opens in the browser (or will be downloadable).
                    </p>

                    <p ng-if="selectedChartType">
                        You selected <b>{{selectedChartType.name}}</b> as a chart type
                    </p>
                </md-text-float>
            </md-card-content>
            <md-action-bar layout="row" layout-align="end center">
                <md-select id="selectChartType" ng-model="selectedChartType" flex="30">
                    <md-select-label>Select a type of chart</md-select-label>
                    <md-option ng-value="c" ng-repeat="c in chartTypes">{{c.name}}</md-option>
                </md-select>
                <md-button ng-click="compareGeneDistribution('html')"
                           class="md-raised" ng-disabled="!selectedChartType">
                    Show chart
                </md-button>
                <md-button class="md-raised" ng-show="currentChart" ng-click="compareGeneDistribution('pdf')">Export as PDF</md-button>
            </md-action-bar>
        </md-card>
        <div>
            <span id="charts" ng-bind-html="currentChart"/>

            <div ng-if="!currentChart">
                <p>
                    Charts will appear in this area, select some genes in the table below and a chart type in the
                    panel
                    on the left side
                </p>
            </div>
        </div>
    </div>
    <md-divider></md-divider>
    <div ng-if="processingInProgress || miningInProgress" layout-padding>
        <md-progress-linear  md-mode="indeterminate"></md-progress-linear><br />
        <strong ng-if="miningInProgress">{{ gridOptions.data.length }} rows imported</strong>
    </div>
    <md-divider></md-divider>
    <div layout="row">
        <md-card flex>
            <md-card-content>
                <md-text-float>
                    <md-subheader class="md-accent" ng-show="!closeAlert5">
                        <button type="button" class="close" aria-label="Close" ng-click="closeAlert5 = true">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        In this panel, you will find a list of the jobs you created on the previous part (Datasets and jobs) or a list of data sets that are
                        attached to the current experiment.
                        <ul>
                            <li>With Retrieve Genes you will get a list of the genes that are in the RNA-Seq counts matrix</li>
                            <li>With Execute Job, you will perform the outlier mining and get outliers in Real-time</li>
                            <li>Remark: It may happen that the outliers are not streamed... in any case, leave the page open while you see the loading animation</li>
                        </ul>
                </md-text-float>
                <div layout-padding>
                    <md-text-float ng-if="!currentExpIdentifier">
                        <md-subheader class="md-primary">Unread Messages
                            Select a virtual experiment before starting to explore the datasets. <br/>
                            Go <a href="#/expression/">to the first page</a> and your experiment will be loaded on this
                            page.
                        </md-subheader>
                    </md-text-float>
                    <md-text-float>
                        <md-subheader class="md-warn">
                            Please note that the export to PDF module is not installed (but CSV is ok).
                        </md-subheader>
                    </md-text-float>
                    <p ng-hide="selectedDataSet == null" class="md-caption">
                        The <b>experiment</b> that you loaded is: {{ currentExpIdentifier }} and the <b>dataset</b>
                        {{selectedDataSet.data.public_identifier}} is selected.
                    </p>

                    <div ng-hide="existingMiningTask == null">
                        <p class="md-caption">
                            The <b>mining</b> task that you selected is based on
                            {{existingMiningTask.data.method.data.name}} and uses the following parameters:
                        </p>
                        <ul>
                            <li>Distance : {{existingMiningTask.data.distance}}</li>
                            <li>Samples : {{existingMiningTask.data.samples}}%</li>
                        </ul>
                        <i>Description: </i>
                        <em>{{existingMiningTask.data.method.data.description}}</em>
                        <p>
                            The mining task identifier is : {{existingMiningTask.data.job.data.public_identifier}}
                        </p>
                    </div>

                    <md-divider></md-divider>

                    <md-whiteframe class="md-whiteframe-z3" layout layout-align="center center">
                        <div class="grid" ui-grid="gridOptions" ui-grid-pagination ui-grid-selection ui-grid-exporter
                             id="sampleValuesTable">
                        </div>
                    </md-whiteframe>
                </div>
            </md-card-content>
            <md-action-bar layout="row" layout-align="end center">
                <md-select ng-model="selectedDataSet" flex="10">
                    <md-select-label>
                        Select a dataset
                    </md-select-label>
                    <md-option ng-value="d" ng-repeat="d in datasets">
                        {{d.data.public_identifier}}
                    </md-option>
                </md-select>

                <md-button ng-disabled="processingInProgress" ng-click="sampleSelected()" class="md-raised">
                    Retrieve genes
                </md-button>
                <md-select ng-model="existingMiningTask" flex="20">
                    <md-select-label>
                        Select an existing mining task
                    </md-select-label>
                    <md-option ng-value="t" ng-repeat="t in existingMiningTasks">
                        {{t.data.public_identifier}}
                    </md-option>
                </md-select>
                <md-button ng-disabled="processingInProgress" ng-click="executeJob(existingMiningTask.data.job.href)" class="md-raised">
                    Execute Job
                </md-button>
            </md-action-bar>
        </md-card>
    </div>
</div>